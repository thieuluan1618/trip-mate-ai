rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Allow authenticated users to upload and read their files
    // Allow guests to upload anonymously
    match /trips/{tripId}/items/{itemId}/{fileName=**} {
      allow read: if true; // Anyone can read files
      allow write: if request.auth != null || request.auth == null; // Allow authenticated and anonymous writes
      allow delete: if request.auth != null; // Only authenticated users can delete
    }
    
    // Deny everything else
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
